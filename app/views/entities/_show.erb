<% ename = entity.name.gsub(' ','_') %>
var <%= entity.name.gsub(' ','_') %>_entity = new MapObject("<%= entity.name %>", 
	map, 
	"/images/<%= entity.image_filename %>", 
	{
		left:<%= entity.pos_x %>,
		top:<%= entity.pos_y %>,
		size:<%= entity.size %>,
		locked:<%= entity.locked.inspect %>,
		deadzone:<%= entity.deadzone.inspect %>
	}
); 

<%= entity.name.gsub(' ','_') %>_entity.afterMove = function(oldPositions) {
	var self = this;
	$.ajax({
		type: "post",
		url: "/moves",
		data: {
			'move[old_x]': oldPositions.xGrid,
			'move[old_y]': oldPositions.yGrid,
			'move[new_x]': self.xGrid,
			'move[new_y]': self.yGrid,
			'move[entity_id]': <%= entity.id %>
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			self.xGrid = oldPositions.xGrid;
			self.yGrid = oldPositions.yGrid;
			self.reDraw();
			MapObject.opacifyOverlapping();
		}
	});
};
